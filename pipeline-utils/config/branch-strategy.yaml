################################################################################
# Branch Strategy Configuration
# Part of Feature 4: Branch Management Automation
#
# Defines branch naming conventions, stale detection thresholds, and
# protection rules for automated branch management.
#
# Branch Naming Rules:
# - pattern: Regex pattern to validate branch names
# - description: Human-readable description of the branch type
# - required: Whether this pattern is mandatory (if true, all branches must match)
#
# Stale Thresholds:
# - stale_threshold_days: Days before a branch is considered stale
# - abandoned_threshold_days: Days before a branch is considered abandoned
#
# Protected Branches:
# - List of branches/patterns that cannot be automatically deleted
################################################################################

# Branch naming convention rules
naming_rules:
  # Feature branches for new functionality
  - pattern: "^feature/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Feature branches for new functionality"
    required: false
    examples:
      - "feature/user-authentication"
      - "feature/dashboard-redesign"
      - "feature/payment-integration"

  # Bugfix branches for fixing defects
  - pattern: "^bugfix/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Bugfix branches for defect fixes"
    required: false
    examples:
      - "bugfix/login-crash"
      - "bugfix/memory-leak"
      - "bugfix/api-timeout"

  # Hotfix branches for production emergencies
  - pattern: "^hotfix/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Hotfix branches for production emergencies"
    required: false
    examples:
      - "hotfix/critical-security"
      - "hotfix/data-corruption"
      - "hotfix-payment-down"

  # Release branches for release preparation
  - pattern: "^release/v[0-9]+\\.[0-9]+\\.[0-9]+(?:-[a-z0-9]+)?$"
    description: "Release branches for version releases"
    required: false
    examples:
      - "release/v1.0.0"
      - "release/v2.1.3"
      - "release/v1.5.0-beta"

  # Support branches for long-term maintenance
  - pattern: "^support/v[0-9]+\\.[0-9]+\\.x$"
    description: "Support branches for long-term maintenance"
    required: false
    examples:
      - "support/v1.0.x"
      - "support/v2.1.x"

  # Documentation branches for docs updates
  - pattern: "^docs/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Documentation branches"
    required: false
    examples:
      - "docs/api-reference"
      - "docs/getting-started"

  # Refactoring branches for code improvements
  - pattern: "^refactor/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Refactoring branches for code improvements"
    required: false
    examples:
      - "refactor/cleanup-legacy-code"
      - "refactor/optimize-queries"

  # Experimental branches for testing ideas
  - pattern: "^experiment/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Experimental branches for R&D"
    required: false
    examples:
      - "experiment/new-ui-framework"
      - "experiment/alternative-approach"

  # Test branches for testing infrastructure
  - pattern: "^test/[a-z0-9-]+(?:-[a-z0-9-]+)*$"
    description: "Test branches for testing infrastructure"
    required: false
    examples:
      - "test/ci-optimization"
      - "test/new-test-framework"

# Stale branch detection thresholds
stale_threshold_days: 30        # Days before a branch is considered stale
abandoned_threshold_days: 60    # Days before a branch is considered abandoned
warning_threshold_days: 21      # Days before warning is sent for stale branches

# Protected branches that cannot be auto-deleted
protected_branches:
  - main
  - master
  - develop
  - development
  - staging
  - production

# Protected branch patterns (regex)
protected_patterns:
  - "^release/.*"           # All release branches
  - "^support/v.*"          # All support branches
  - "^hotfix/.*"            # All hotfix branches

# Branch cleanup configuration
cleanup:
  # Auto-delete merged branches
  auto_delete_merged: true
  merged_retention_days: 7  # Keep merged branches for 7 days before deletion

  # Auto-delete stale branches
  auto_delete_stale: false  # Set to true to enable auto-deletion
  stale_retention_days: 90  # Keep stale branches for 90 days before deletion

  # Dry-run mode (preview changes without executing)
  dry_run: false

# PR warning configuration
pr_warning:
  enabled: true
  template: |
    ⚠️ **This branch has been inactive for {{DAYS}} days**

    This branch hasn't been updated in {{DAYS}} days. Please consider:
    - Updating the branch with the latest changes from main
    - Closing this PR if it's no longer needed
    - Responding to any pending review comments

    If this branch remains inactive for {{ABANDONED_DAYS}} days, it may be automatically deleted.

  mention_team: false  # Whether to @mention the team
  mention_assignees: true  # Whether to @mention PR assignees

# Branch validation configuration
validation:
  # Enforce naming conventions
  enforce_naming: false  # Set to true to reject non-compliant branches

  # Allow branches with valid patterns even if not explicitly listed
  allow_valid_patterns: true

  # Reject common problematic branch names
  rejected_patterns:
    - "^tmp.*"
    - "^temp.*"
    - "^test.*-test$"
    - "^xxx.*"
    - "^wip.*"

# Notification configuration
notifications:
  # Notify on branch deletion
  notify_on_delete: true

  # Notify on stale detection
  notify_on_stale: true

  # Notification channels (comma-separated)
  channels: "slack,github"

  # Additional notification recipients
  recipients: []

# Database logging configuration
database:
  # Log branch status changes
  log_status_changes: true

  # Log branch deletions
  log_deletions: true

  # Log validation failures
  log_validation_failures: true

  # Retention period for branch history (days)
  history_retention_days: 365

# Integration settings
github:
  # Use gh CLI for GitHub operations
  use_gh_cli: true

  # API endpoint (for GitHub Enterprise)
  api_endpoint: ""

  # Default repository (if not detected from CI)
  default_repo: ""

# Reporting configuration
reporting:
  # Generate JSON report
  json_report: true

  # Generate Markdown report
  markdown_report: true

  # Report directory
  report_dir: "build/branch-management"

  # Include detailed branch metadata
  include_metadata: true

  # Include PR information
  include_pr_info: true

################################################################################
# Usage Examples:
#
# 1. Add custom branch type:
#    naming_rules:
#      - pattern: "^custom/[a-z0-9-]+$"
#        description: "Custom branch type"
#
# 2. Enable strict naming enforcement:
#    validation:
#      enforce_naming: true
#
# 3. Adjust stale thresholds:
#    stale_threshold_days: 14
#    abandoned_threshold_days: 30
#
# 4. Add protected branches:
#    protected_branches:
#      - main
#      - develop
#      - my-special-branch
#
# For more information, see:
# - Feature 4 Summary: (to be created)
# - Branch Management Guide: (to be created)
################################################################################
